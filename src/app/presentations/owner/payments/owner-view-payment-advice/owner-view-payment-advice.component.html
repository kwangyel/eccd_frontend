<p-confirmDialog />

<div style="min-width: 40vw">
    <div class="flex justify-content-between align-items-end">
        <div class="flex flex-column gap-2">
            <p-image [src]="adminProfileUri" alt="Image" width="100" imageClass="circular" />
        </div>
        <div *ngIf="admin" class="text-right">
            <p>{{ admin.nameEnglish }} / {{ admin.nameDzongkha }}</p>

            <p>Phone:{{ admin.phoneNumber }}</p>
            <p>Email:{{ admin.email }}</p>
            <p>{{ admin.permanentAddress }}</p>
        </div>
    </div>

    <p-divider></p-divider>

    <div class="mt-4 mb-4">
        <div class="flex gap-2 algin-items-center">
            <p-tag [severity]="getTagSeverity(paymentAdvice.status)" [value]="paymentAdvice.status"></p-tag>
            <p class="font-semibold text-lg">
                #{{ paymentAdvice.id }} {{ paymentAdvice?.title }}
            </p>
        </div>
        <p class="mt-1">
            Due Date: {{ paymentAdvice.dueDate | date : "mediumDate" }}
        </p>

        <div>
            <p-table [value]="paymentAdvice?.paymentAdviseItem" [tableStyle]="{ width: '100%' }"
                styleClass="p-datatable-sm">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Particular</th>
                        <th>Amount</th>
                    </tr>
                </ng-template>

                <ng-template pTemplate="body" let-item>
                    <tr>
                        <td>{{ item.particular }}</td>
                        <td>Nu. {{ item.amount }}</td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="footer">
                    <tr class="bg-red-100 text-red-200" *ngIf="applyPenaltySetting">
                        <td>Penalty</td>
                        <td>
                            <div class="flex gap-2 algin-items-center">
                                <p [ngClass]="
                                        isPenaltyWrittenOff
                                            ? 'line-through'
                                            : ''
                                    ">
                                    Nu.
                                    {{
                                    penalty?.totalPenalty +
                                    penalty?.penaltyPaid || 0
                                    }}
                                </p>
                                <p class="text-sm font-normal" *ngIf="
                                        !isPenaltyWrittenOff &&
                                        paymentAdvice.status !==
                                            paymentAdviceStatus.PAID
                                    ">
                                    OverDue by {{ penalty?.daysOverDue }} day/s
                                </p>
                                <p *ngIf="isPenaltyWrittenOff">
                                    *Penalty Written Off
                                </p>
                            </div>
                        </td>
                    </tr>
                    <tr class="bg-red-100 text-red-200" *ngIf="penalty?.penaltyPaid">
                        <td>Penalty Paid</td>
                        <td>
                            <div class="flex gap-2">
                                <p [ngClass]="
                                        isPenaltyWrittenOff
                                            ? 'line-through'
                                            : ''
                                    ">
                                    Nu.
                                    {{ penalty?.penaltyPaid }}
                                </p>
                            </div>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>

        <div class="flex justify-content-end align-items-center mt-4 gap-4" *ngIf="
                !isPenaltyWrittenOff &&
                penalty?.totalPenalty > 0 &&
                paymentAdvice.status !== paymentAdviceStatus.PAID
            ">
            <p *ngIf="penalty.daysOverDue">
                Over due by:
                {{ penalty.daysOverDue }} Day/s
            </p>
            <p-button size="small" [text]="true" severity="danger" label="write off penalty"
                (click)="confirmWriteOffPenalty(paymentAdvice)"></p-button>
        </div>
        <div class="flex justify-content-end align-items-center mt-4 gap-4" *ngIf="
                isPenaltyWrittenOff &&
                penalty?.totalPenalty > 0 &&
                paymentAdvice.status !== paymentAdviceStatus.PAID
            ">
            <p *ngIf="penalty.daysOverDue">
                Over due by:
                {{ penalty.daysOverDue }} Day/s
            </p>
            <p-button size="small" [text]="true" severity="danger" label="Revert write off penalty"
                (click)="confirmRevertWriteOffPenalty(paymentAdvice)"></p-button>
        </div>
        <!-- <p-button size="small" label="Apply discount"></p-button> -->
    </div>

    <div class="flex justify-content-between align-items-end mt-4">
        <div>
            <p class="mb-2">
                {{
                paymentAdvice.status === paymentAdviceStatus.PAID
                ? "Received From"
                : "To be Received from"
                }}
            </p>
            <p>
                Name:{{ paymentAdvice.leaseAgreement?.tenant?.nameEnglish }}
            </p>
            <p>Phone:{{ paymentAdvice.leaseAgreement?.tenant?.phoneNumber }}</p>
            <p>CID:{{ paymentAdvice.leaseAgreement?.tenant?.cid }}</p>
        </div>

        <div class="text-right">
            <div class="mb-2">
                <p>Payment Date:</p>
                <p-calendar [(ngModel)]="paymentDate" [showIcon]="true" [showOnFocus]="false" dateFormat="dd/mm/yy"
                    appendTo="body" placeholder="Select Date" (onSelect)="onDateSelected($event)" />
            </div>
            <p class="text-lg">
                Amount Due: <strong>Nu. {{ totalAmountDue }}</strong>
                <br />
                <small *ngIf="
                        !isPenaltyWrittenOff && penalty?.totalPenalty
                    ">
                    (advice due amount + penalty)
                </small>
            </p>
            <p class="mt-2">
                Advice Amount: <strong> Nu. {{ totalAmmount }}</strong>
            </p>
        </div>
    </div>

    <div class="flex justify-content-end align-items-end gap-4 my-4">
        <!-- <p-button label="Download PDF" size="small" severity="secondary" (click)="downloadAdvicePdf()"></p-button> -->
        <p-button label="Receive Payment" size="small" *ngIf="totalAmountDue !== 0"
            (click)="receivePayment()"></p-button>
    </div>
</div>