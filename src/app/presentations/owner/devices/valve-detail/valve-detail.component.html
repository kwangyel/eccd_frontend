<div class="mx-auto p-4 flex flex-column gap-4">
    <div class="p-4">
      
      <!-- Connection Status -->
      <div class="mb-4 p-3 border-round-lg" 
           [class]="connectionStatus.connected ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'">
        <div class="flex align-items-center gap-2">
          <i class="pi" 
             [class]="connectionStatus.connected ? 'pi-check-circle text-green-600' : 'pi-times-circle text-red-600'">
          </i>
          <span class="font-medium" 
                [class]="connectionStatus.connected ? 'text-green-700' : 'text-red-700'">
            {{ connectionStatus.message }}
          </span>
          <p-tag *ngIf="connectionStatus.connected" 
                 value="LIVE" 
                 severity="success" 
                 class="ml-2">
          </p-tag>
        </div>
      </div>

      <!-- Current Position -->
      <div class="mb-4">
        <h4 class="mb-2 text-700 font-medium">Current Position</h4>
        <div class="flex align-items-center justify-content-center gap-4">
          <p-knob 
            [(ngModel)]="currentValvePosition" 
            [min]="0" 
            [max]="100" 
            [size]="150"
            [strokeWidth]="18"
            [showValue]="true"
            [readonly]="true"
            valueTemplate="{value}%"
            [style]="{'color': getValveStatusColor()}">
          </p-knob>
        </div>
        <div class="text-center mt-2">
          <p class="text-lg font-medium mb-1">{{ getValveStatusText() }}</p>
          <p class="text-sm text-600">Last Updated: {{ lastUpdated }}</p>
        </div>
      </div>

      <p-divider></p-divider>

      <!-- Control Section -->
      <div>
        <h4 class="mb-4 text-700 font-medium">Adjust Valve Position</h4>
        
        <!-- Preset Buttons -->
        <div class="mb-4">
          <label class="block mb-3 font-medium text-900">Quick Presets:</label>
          <div class="flex gap-2 justify-content-center flex-wrap">
            <p-button 
              label="🔓 OPEN (0%)" 
              severity="success"
              size="small"
              (onClick)="setPresetPosition(0)"
              [disabled]="isValveAdjusting || !connectionStatus.connected">
            </p-button>
            
            <p-button 
              label="↔️ HALF (50%)" 
              severity="warning"
              size="small"
              (onClick)="setPresetPosition(50)"
              [disabled]="isValveAdjusting || !connectionStatus.connected">
            </p-button>
            
            <p-button 
              label="🔒 CLOSE (100%)" 
              severity="danger"
              size="small"
              (onClick)="setPresetPosition(90)"
              [disabled]="isValveAdjusting || !connectionStatus.connected">
            </p-button>
          </div>
        </div>

        <!-- Slider Container -->
        <div class="mb-4">
          <label for="valve-slider" class="block mb-3 font-medium text-900 text-lg">
            Target Position: {{ targetValvePosition }}%
          </label>
          <p-slider 
            id="valve-slider"
            [(ngModel)]="targetValvePosition" 
            [min]="0" 
            [max]="90" 
            [step]="1"
            (onChange)="onSliderChange($event)"
            [disabled]="isValveAdjusting || !connectionStatus.connected"
            class="w-full my-4">
          </p-slider>
          
          <div class="flex justify-content-between mt-2 text-sm text-600">
            <span>0% (Open)</span>
            <span>100% (Closed)</span>
          </div>
        </div>

        <!-- Control Buttons -->
        <div class="flex gap-3 mb-4 justify-content-center flex-wrap">
          <p-button 
            label="Apply Setting" 
            icon="pi pi-check" 
            severity="success"
            (onClick)="confirmValveAdjustment()"
            [disabled]="isValveAdjusting || targetValvePosition === currentValvePosition || !connectionStatus.connected"
            class="px-4 py-2 font-semibold">
          </p-button>
          
        </div>

        <!-- Adjusting Indicator -->
        <div *ngIf="isValveAdjusting" 
             class="flex align-items-center justify-content-center gap-2 p-3 bg-blue-50 border-round-lg text-blue-600 font-medium">
          <i class="pi pi-spin pi-spinner text-lg"></i>
          <span>Sending command to valve...</span>
        </div>

        <!-- Connection Warning -->
        <div *ngIf="!connectionStatus.connected" 
             class="flex align-items-center justify-content-center gap-2 p-3 bg-orange-50 border-round-lg text-orange-600 font-medium">
          <i class="pi pi-exclamation-triangle text-lg"></i>
          <span>Valve control disabled - Firebase connection required</span>
        </div>
      </div>
    </div>
</div>

<p-confirmDialog 
  [style]="{width: '450px'}"
  [baseZIndex]="10000"
  rejectButtonStyleClass="p-button-text">
</p-confirmDialog>

<p-toast position="top-right"></p-toast>
