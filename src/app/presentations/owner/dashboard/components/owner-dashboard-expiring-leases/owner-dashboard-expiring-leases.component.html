<p-card styleClass="h-full">
    <ng-template pTemplate="header">
        <div class="flex justify-content-between align-items-center">
            <div>
                <h3 class="text-xl font-semibold text-primary m-0">
                    Expiring Leases
                </h3>
                <span class="text-500 text-sm"
                    >Leases expiring in the next 60 days</span
                >
            </div>
            <p-button
                icon="pi pi-external-link"
                label="View All"
                styleClass="p-button-text"
            >
            </p-button>
        </div>
    </ng-template>

    <p-table
        [value]="expiringLeases"
        [rows]="5"
        [paginator]="true"
        [loading]="loading"
        styleClass="p-datatable-sm"
        responsiveLayout="stack"
        [scrollable]="true"
        scrollHeight="400px"
    >
        <ng-template pTemplate="header">
            <tr>
                <th class="min-w-15rem">Property</th>
                <th class="min-w-15rem">Tenant</th>
                <th class="min-w-10rem">End Date</th>
                <th class="min-w-8rem">Status</th>
                <th class="min-w-8rem">Actions</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-lease>
            <tr
                [ngClass]="{
                    'bg-yellow-50':
                        getDaysUntilExpiration(lease.leaseEndDate) <= 30
                }"
            >
                <td>
                    <div class="flex flex-column">
                        <span class="font-medium">{{
                            getPropertyDetails(lease)
                        }}</span>
                        <span class="text-sm text-600">{{ lease.use }}</span>
                    </div>
                </td>
                <td>
                    <div class="flex flex-column">
                        <span class="font-medium">{{
                            lease.tenant?.nameEnglish
                        }}</span>
                        <div
                            class="flex align-items-center gap-2 text-sm text-600"
                        >
                            <i class="pi pi-phone"></i>
                            <span>{{ lease.tenant?.phoneNumber }}</span>
                        </div>
                    </div>
                </td>
                <td>
                    <div class="flex flex-column">
                        <span
                            [ngClass]="{
                                'text-orange-500 font-medium':
                                    getDaysUntilExpiration(
                                        lease.leaseEndDate
                                    ) <= 30,
                                'text-red-500 font-bold':
                                    getDaysUntilExpiration(
                                        lease.leaseEndDate
                                    ) <= 7
                            }"
                        >
                            {{ lease.leaseEndDate | date : "mediumDate" }}
                        </span>
                        <span
                            class="text-sm mt-1"
                            [ngClass]="{
                                'text-orange-500':
                                    getDaysUntilExpiration(
                                        lease.leaseEndDate
                                    ) <= 30,
                                'text-red-500 font-medium':
                                    getDaysUntilExpiration(
                                        lease.leaseEndDate
                                    ) <= 7
                            }"
                        >
                            <i class="pi pi-clock mr-1"></i>
                            {{ getDaysUntilExpiration(lease.leaseEndDate) }}
                            days left
                        </span>
                    </div>
                </td>
                <td>
                    <span
                        class="inline-flex align-items-center gap-1 border-round px-2 py-1"
                        [ngClass]="getStatusClass(lease.status)"
                    >
                        <i
                            class="pi pi-exclamation-circle text-sm"
                            *ngIf="lease.status === 'UPCOMING_EXPIRATION'"
                        ></i>
                        {{ getStatusText(lease.status) }}
                    </span>
                </td>
                <td>
                    <div class="flex gap-2">
                        <p-button
                            icon="pi pi-eye"
                            pTooltip="View Details"
                            tooltipPosition="top"
                            (click)="viewLease(lease)"
                            styleClass="p-button-rounded p-button-text"
                        >
                        </p-button>
                        <p-button
                            icon="pi pi-refresh"
                            pTooltip="Renew Lease"
                            tooltipPosition="top"
                            (click)="renewLease(lease)"
                            styleClass="p-button-rounded p-button-text p-button-success"
                        >
                        </p-button>
                    </div>
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="5" class="text-center p-4">
                    <div class="flex flex-column align-items-center">
                        <i
                            class="pi pi-check-circle text-success text-4xl mb-2"
                        ></i>
                        <span class="text-700">No expiring leases found</span>
                        <span class="text-500 text-sm mt-1"
                            >All your leases are in good standing</span
                        >
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>
</p-card>
